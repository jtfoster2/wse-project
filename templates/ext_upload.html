<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Extensions Upload</title>

     <!-- Bootstrap CSS -->
     <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  </head>

<body>
    <div class="container-fluid p-3">
        <div class="d-flex justify-content-between">
            <a href="ext_status.html" class="btn btn-outline-secondary" id="uploads">Uploads</a>
            <button class="btn btn-outline-danger">Logout</button>
        </div>
        <div class="row mt-3">
            <div class="col-md-2 bg-light p-3">
                <button class="btn btn-secondary w-100">Search</button>
            </div>
            <div class="col-md-10">
                <form action="/extension" method="PUT" enctype="multipart/form-data">
                    <div class="card p-3">
                        <div class="card-body">
                            <h5 class="card-title text-center">Extension Details</h5>
                            <div class="mb-3">
                              <label for="title" class="form-label">Title</label>
                              <input type="text" class="form-control" id="title" name="title" required>
                          </div>
                          <div class="mb-3">
                              <label for="creator" class="form-label">Creator</label>
                              <input type="text" class="form-control" id="creator" name="creator" required>
                          </div>
                          <div class="mb-3">
                              <label for="extends" class="form-label">Extends</label>
                              <input type="text" class="form-control" id="extends" name="extends" required>
                          </div>
                          <div class="mb-3">
                              <label for="summary" class="form-label">Summary</label>
                              <input type="text" class="form-control" id="summary" name="summary" required>
                          </div>
                          <div class="mb-3">
                              <label for="meta_license" class="form-label">Meta License</label>
                              <input type="text" class="form-control" id="meta_license" name="meta_license" required>
                          </div>
                          <div class="mb-3">
                              <label for="project_license" class="form-label">Project License</label>
                              <input type="text" class="form-control" id="project_license" name="project_license" required>
                          </div>
                          <div class="mb-3">
                              <label for="description" class="form-label">Description</label>
                              <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                          </div>
                          <div class="mb-3">
                              <label for="tags" class="form-label">Tags(comma-separated)</label>
                              <input type="text" class="form-control" id="tags" name="tags">
                          </div>
                          <div class="mb-3">
                              <label for="screenshots" class="form-label">Screenshots(comma-separated URLs)</label>
                              <input type="text" class="form-control" id="screenshots" name="screenshots">
                          </div>
                          <div class="mb-3">
                              <label for="releases" class="form-label">Releases(comma-separated version info)</label>
                              <input type="text" class="form-control" id="releases" name="releases">
                          </div>
                        </div>
                    </div>
                    <div class="card p-3 mt-3">
                        <div class="card-body text-center">
                            <label for="fileUpload" class="form-label">.gex file upload</label>
                            <input type="file" class="form-control" id="fileUpload" name="file" required>
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('extensionForm').addEventListener('submit',function(event){
            event.preventDefault();
    
            const form = document.getElementById('extensionForm');
            const formData = new FormData(form);
    
            fetch('/extension', {
                method: 'PUT',
                body: formData
            })
                .then(response => {
                    if(response.redirected) {
                        window.location.href = response.url;
                    } else if(response.headers.get("content-type")?.includes("application/json")){
                        return response.json();
                    }
                    else{
                        return response.text();
                    }
                })
                .then(data => {
                    if(data) {
                        alert('Extension upload successful!');
                        console.log(data);
                    }
                })
                .catch(error => {
                    console.error('Error: ',error);
                    alert('Upload unsuccessful');
                });
        });
    </script>
</body>

</html>