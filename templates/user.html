<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Extension Search Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <a href="/" class="btn btn-outline-danger">Login</a>
    </div>

    <!--Search-->
    <div class="mb-4 d-flex">
      <input id="searchInput" type="text" class="form-control me-2" placeholder="Search extensions...">
      <button class="btn btn-primary" onclick="searchExtensions()">Search</button>
    </div>

    <!--Search results display-->
    <div id="searchResults"></div>
  </div>

  <script>
    async function searchExtensions() {
      const query = document.getElementById('searchInput').value || '_';
      const tags = '_'; // optional support later

      const response = await fetch(`/extension/searchExtensions/${encodeURIComponent(query)}/${tags}`);
      const results = await response.json();

      const container = document.getElementById('searchResults');
      container.innerHTML = '';

      if (results.length === 0) {
        container.innerHTML = '<p>No extensions found.</p>';
        return;
      }

      results.forEach(ext => {
        const card = document.createElement('div');
        card.className = 'card mb-3';
        card.innerHTML = `
          <div class="card-header"><strong>${ext.title}</strong></div>
          <div class="card-body">
            <p><strong>Summary:</strong> ${ext.summary}</p>
            <p><strong>Description:</strong> ${ext.description}</p>
            <p><strong>Version(s):</strong> ${ext.releases.join(', ')}</p>
            <div class="text-end">
              <button class="btn btn-primary me-2" onclick="downloadExtension(${ext.id}, '${ext.releases[0]}')">Download</button>
              <button class="btn btn-warning" onclick="flagExtension(${ext.id})">Flag</button>
            </div>
            <textarea class="form-control mt-2" placeholder="Optional reason for flagging (not saved)"></textarea>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function downloadExtension(id, version) {
      window.location.href = `/repository/extension/${id}/${version}`;
    }

    async function flagExtension(id) {
      const res = await fetch(`/extension/${id}/flag`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (res.ok) {
        alert("Extension flagged for review.");
      } else {
        alert("Failed to flag the extension.");
      }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
